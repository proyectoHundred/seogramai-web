<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SeogramAI</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            tiffany: "#40E0D0",
          },
        },
      },
    };
  </script>
</head>
<body class="bg-white text-gray-900 p-6">
  <h1 class="text-4xl font-bold mb-6 text-center">
    Optimiza tu página web con <span class="text-tiffany">IA</span> en segundos
  </h1>

  <form id="urlForm" class="flex flex-col md:flex-row gap-4 justify-center max-w-xl mx-auto mb-8">
    <input
      type="url"
      id="urlInput"
      required
      placeholder="https://tusitio.com"
      class="flex-grow px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-tiffany"
    />
    <button
      type="submit"
      class="bg-tiffany hover:bg-teal-400 text-white px-6 py-3 rounded-lg font-medium transition"
    >
      Analizar
    </button>
  </form>

  <section class="max-w-4xl mx-auto bg-gray-50 border border-gray-300 rounded-lg p-6 shadow">
    <h2 class="text-2xl font-semibold mb-4">Mejoras detectadas</h2>

    <div id="improvements" class="mb-6 space-y-4 text-gray-700"></div>

    <button
      id="downloadBtn"
      disabled
      class="bg-tiffany hover:bg-teal-400 text-white px-6 py-3 rounded-lg font-medium transition disabled:opacity-50"
    >
      Descargar HTML optimizado
    </button>
  </section>

  <script>
    const form = document.getElementById("urlForm");
    const input = document.getElementById("urlInput");
    const improvements = document.getElementById("improvements");
    const downloadBtn = document.getElementById("downloadBtn");

    let optimizedHTML = "";

    function createList(title, items) {
      if (!items || items.length === 0) return "";
      let html = `<h3 class="font-semibold text-lg mb-2">${title}:</h3><ul class="list-disc ml-6">`;
      items.forEach(item => {
        if(typeof item === "string") {
          html += `<li>${item}</li>`;
        } else if(item.tag && item.text) {
          html += `<li><strong>${item.tag.toUpperCase()}:</strong> ${item.text}</li>`;
        } else if(item.src && item.alt) {
          html += `<li><strong>Img:</strong> src="${item.src}", alt="${item.alt}"</li>`;
        }
      });
      html += "</ul>";
      return html;
    }

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = input.value.trim();
      if (!url) {
        alert("Introduce una URL válida");
        return;
      }

      improvements.innerHTML = "Analizando...";
      downloadBtn.disabled = true;

      try {
        const response = await fetch("https://backend-xpf4.onrender.com/optimize", {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({ url }),
        });
        const data = await response.json();

        if (data.error) {
          improvements.textContent = `Error: ${data.error}`;
          return;
        }

        let html = "";
        if(data.title) html += `<p><strong>Título optimizado:</strong> ${data.title}</p>`;
        if(data.meta_description) html += `<p><strong>Meta descripción:</strong> ${data.meta_description}</p>`;
        html += createList("Encabezados (headings)", data.headings);
        html += createList("Imágenes con texto alternativo", data.images_alt);

        if(data.open_graph && Object.keys(data.open_graph).length > 0) {
          html += "<h3 class='font-semibold text-lg mt-4'>Open Graph:</h3><ul class='list-disc ml-6'>";
          for(const [key, value] of Object.entries(data.open_graph)) {
            html += `<li><strong>${key}:</strong> ${value}</li>`;
          }
          html += "</ul>";
        }

        if(data.twitter_card && Object.keys(data.twitter_card).length > 0) {
          html += "<h3 class='font-semibold text-lg mt-4'>Twitter Card:</h3><ul class='list-disc ml-6'>";
          for(const [key, value] of Object.entries(data.twitter_card)) {
            html += `<li><strong>${key}:</strong> ${value}</li>`;
          }
          html += "</ul>";
        }

        improvements.innerHTML = html;

        optimizedHTML = data.optimized_html;
        downloadBtn.disabled = false;
      } catch (error) {
        improvements.textContent = "Error al conectar con el backend.";
        console.error(error);
      }
    });

    downloadBtn.addEventListener("click", () => {
      const blob = new Blob([optimizedHTML], { type: "text/html" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "pagina_optimizada.html";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
